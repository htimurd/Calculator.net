<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Calculator.net - Dev Edition</title>
    <style>
        :root { --orange: #ff9500; --red: #ff3b30; --green: #28cd41; --gray: #555; }
        
        body {
            background-color: #000; display: flex; justify-content: flex-start;
            align-items: center; height: 100vh; margin: 0; padding-left: 50px;
            font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden;
        }

        /* Анимации */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        .shake { animation: shake 0.3s ease-in-out; }

        /* Профиль и Меню */
        .top-menu { position: absolute; top: 25px; right: 30px; display: flex; gap: 15px; align-items: center; }
        .buy-zone { display: flex; flex-direction: column; align-items: center; }
        .current-status { font-size: 10px; color: #555; margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }

        .profile-box { text-align: right; display: none; }
        .profile-name { font-weight: bold; font-size: 16px; color: white; }
        .profile-email { font-size: 11px; color: #777; display: block; margin-top: -2px; }
        .btn-logout { background: none; border: none; color: var(--red); font-size: 10px; cursor: pointer; text-decoration: underline; padding: 0; }
        .btn-dev { background: none; border: 1px solid #333; color: #555; font-size: 10px; padding: 4px 8px; cursor: pointer; border-radius: 3px; }

        .nav-btn { padding: 10px 20px; border-radius: 6px; border: 1px solid #444; cursor: pointer; background: transparent; color: white; transition: 0.3s; }
        .btn-buy { background-color: var(--orange) !important; color: #000 !important; font-weight: bold; border: none !important; }

        /* Калькулятор */
        .calc-wrapper { width: 320px; }
        #display { width: 100%; height: 90px; background: transparent; border: 2px solid var(--orange); color: white; font-size: 42px; text-align: right; margin-bottom: 25px; padding: 15px; box-sizing: border-box; border-radius: 12px; outline: none; }
        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .calc-btn { height: 65px; border-radius: 10px; border: 1px solid #333; background: #1a1a1a; color: white; font-size: 22px; cursor: pointer; opacity: 0.4; transition: 0.2s; }
        .unlocked { opacity: 1; }
        .op { color: var(--orange); }
        .equal { background: #333; color: var(--orange); font-weight: bold; }
        .equal.unlocked { background: var(--orange) !important; color: black !important; }

        /* Модалки */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); justify-content: center; align-items: center; }
        .modal-content { background: #111; padding: 30px; border-radius: 15px; border: 1px solid var(--orange); width: 380px; position: relative; text-align: center; }
        
        .modal-console { width: 90% !important; max-width: 1200px; height: 85vh; display: flex; flex-direction: column; }
        #devConsole { flex-grow: 1; background: #000; color: #fff; font-family: 'Consolas', monospace; text-align: left; font-size: 14px; padding: 15px; overflow-y: auto; border: 1px solid #222; }
        .cmd-line { display: flex; background: #000; padding: 10px; border: 1px solid #222; border-top: none; align-items: center; }
        .cmd-prefix { color: var(--orange); margin-right: 10px; font-weight: bold; }
        .cmd-input { background: transparent; border: none; color: #fff; flex-grow: 1; outline: none; font-family: monospace; }

        .close-x { position: absolute; right: 20px; top: 15px; color: #555; cursor: pointer; font-size: 28px; }

        .auth-btn { width: 100%; padding: 12px; background: var(--orange); border: none; color: black; font-weight: bold; margin: 10px 0; cursor: pointer; border-radius: 5px; }
        .auth-btn:disabled { background: #222 !important; color: var(--gray) !important; cursor: not-allowed; border: 1px dashed #444; }
        .btn-cancel-red { background: var(--red) !important; color: white !important; margin-top: 15px; }

        .proc-status { color: #fff; font-size: 16px; min-height: 110px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; line-height: 1.6; margin-bottom: 10px; }
        .final-btns { display: none; flex-direction: column; gap: 10px; margin-top: 20px; }

        .auth-input { width: 100%; padding: 12px; margin: 6px 0; background: #222; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; outline: none; }
        .link-text { color: #888; font-size: 13px; margin-top: 15px; cursor: pointer; }
        .link-text span { color: var(--orange); font-weight: bold; text-decoration: underline; }

        .footer-text { position: absolute; bottom: 30px; right: 40px; color: #444; font-size: 20px; user-select: none; }
        .dots::after { content: ''; animation: dots 1.5s infinite; }
        @keyframes dots { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }
    </style>
</head>
<body>

    <div class="top-menu">
        <button id="devBtn" class="btn-dev" style="display:none;" onclick="openModal('devModal')">ДЛЯ РАЗРАБОТЧИКОВ</button>
        <div class="buy-zone">
            <button class="nav-btn btn-buy" onclick="openModal('buyModal')">Улучшить Тариф</button>
            <div id="statusLabel" class="current-status">Тариф: NONE</div>
        </div>
        <button id="loginBtn" class="nav-btn" onclick="openModal('loginModal')">Войти</button>
        <div id="profileBox" class="profile-box">
            <span id="pName" class="profile-name">User</span>
            <span id="pEmail" class="profile-email">email@gmail.com</span>
            <button class="btn-logout" onclick="location.reload()">Выйти</button>
        </div>
    </div>

    <div class="calc-wrapper" id="calcMain">
        <input type="text" id="display" readonly placeholder="0">
        <div class="buttons">
            <button id="btn-C" class="calc-btn op" data-tier="super" onclick="press('C')">C</button>
            <button id="btn-del" class="calc-btn op" data-tier="super" onclick="press('del')">←</button>
            <button id="btn-perc" class="calc-btn op" data-tier="super" onclick="press('perc')">%</button>
            <button id="btn-div" class="calc-btn op" data-tier="super" onclick="press('div')">÷</button>
            <button id="btn-7" class="calc-btn" data-tier="standart" onclick="press('7')">7</button>
            <button id="btn-8" class="calc-btn" data-tier="standart" onclick="press('8')">8</button>
            <button id="btn-9" class="calc-btn" data-tier="standart" onclick="press('9')">9</button>
            <button id="btn-mul" class="calc-btn op" data-tier="super" onclick="press('mul')">×</button>
            <button id="btn-4" class="calc-btn" data-tier="standart" onclick="press('4')">4</button>
            <button id="btn-5" class="calc-btn" data-tier="standart" onclick="press('5')">5</button>
            <button id="btn-6" class="calc-btn" data-tier="standart" onclick="press('6')">6</button>
            <button id="btn-sub" class="calc-btn op" data-tier="pro" onclick="press('sub')">-</button>
            <button id="btn-1" class="calc-btn" data-tier="standart" onclick="press('1')">1</button>
            <button id="btn-2" class="calc-btn" data-tier="standart" onclick="press('2')">2</button>
            <button id="btn-3" class="calc-btn" data-tier="standart" onclick="press('3')">3</button>
            <button id="btn-add" class="calc-btn op" data-tier="pro" onclick="press('add')">+</button>
            <button id="btn-0" class="calc-btn" data-tier="standart" onclick="press('0')" style="grid-column: span 2;">0</button>
            <button id="btn-dot" class="calc-btn" data-tier="standart" onclick="press('dot')">.</button>
            <button id="btn-equal" class="calc-btn equal" data-tier="mega" onclick="press('equal')">=</button>
        </div>
    </div>

    <!-- Модалки -->
    <div id="devModal" class="modal">
        <div class="modal-content modal-console">
            <span class="close-x" onclick="closeModals()">&times;</span>
            <h2 style="text-align: left; color: var(--orange); margin: 0 0 10px 0;">Console</h2>
            <div id="devConsole"></div>
            <div class="cmd-line">
                <span class="cmd-prefix">></span>
                <input type="text" id="cmdInput" class="cmd-input" placeholder="Введите команду..." autocomplete="off">
            </div>
        </div>
    </div>

    <div id="buyModal" class="modal">
        <div class="modal-content">
            <span class="close-x" onclick="closeModals()">&times;</span>
            <h2>Магазин</h2>
            <button id="buy-standart" class="auth-btn" onclick="startPurchase('standart', 'pro')">STANDART (бесплатно)</button>
            <button id="buy-pro" class="auth-btn" onclick="startPurchase('pro', 'super')" disabled>PRO (бесплатно)</button>
            <button id="buy-super" class="auth-btn" onclick="startPurchase('super', 'mega')" disabled>SUPER (бесплатно)</button>
            <button id="buy-mega" class="auth-btn" onclick="startPurchase('mega', null)" disabled>MEGA (бесплатно)</button>
            <button style="margin-top:15px; color:var(--red); background:none; border:none; cursor:pointer;" onclick="location.reload()">Убрать тариф</button>
        </div>
    </div>

    <div id="procModal" class="modal">
        <div class="modal-content" id="procContent">
            <h2 id="procTitle">Статус операции</h2>
            <!-- Статус и надписи -->
            <div id="procStatus" class="proc-status"></div>
            <!-- Кнопка отмены СТРОГО ПОД статусом -->
            <button id="cancelBtn" class="auth-btn btn-cancel-red" onclick="cancelPurchase()">ОТМЕНИТЬ</button>
            
            <div id="finalBtns" class="final-btns">
                <button class="auth-btn" onclick="openModal('buyModal')">К тарифам</button>
                <button class="auth-btn" style="background:#222; color:white;" onclick="closeModals()">Главная страница</button>
            </div>
        </div>
    </div>

    <!-- Вход / Регистрация -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-x" onclick="closeModals()">&times;</span>
            <h2>Вход</h2>
            <input type="text" id="lName" class="auth-input" placeholder="Имя">
            <input type="password" id="lPass" class="auth-input" placeholder="Пароль">
            <button class="auth-btn" onclick="handleLogin()">Войти</button>
            <div class="link-text" onclick="openModal('regModal')">Нет аккаунта? <span>Создать</span></div>
        </div>
    </div>

    <div id="regModal" class="modal">
        <div class="modal-content">
            <span class="close-x" onclick="closeModals()">&times;</span>
            <h2>Регистрация</h2>
            <input type="text" id="rName" class="auth-input" placeholder="Имя">
            <input type="email" id="rE1" class="auth-input" placeholder="Email">
            <input type="email" id="rE2" class="auth-input" placeholder="Повторите Email">
            <input type="password" id="rP1" class="auth-input" placeholder="Пароль">
            <input type="password" id="rP2" class="auth-input" placeholder="Повторите пароль">
            <button class="auth-btn" onclick="handleRegister()">Зарегистрироваться</button>
        </div>
    </div>

    <div class="footer-text">calculator.net</div>

    <script>
        const display = document.getElementById('display');
        const statusLabel = document.getElementById('statusLabel');
        const devConsole = document.getElementById('devConsole');
        const cmdInput = document.getElementById('cmdInput');
        let unlocked = [];
        let timer;
        let isAuth = false;
        let purchaseActive = false;

        function log(msg, color = "#fff") {
            const time = new Date().toLocaleTimeString();
            devConsole.innerHTML += `<div style="color:${color}">[${time}] ${msg}</div>`;
            devConsole.scrollTop = devConsole.scrollHeight;
        }

        cmdInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const fullCmd = cmdInput.value.trim().toLowerCase();
                const parts = fullCmd.split(' ');
                const cmd = parts[0];
                const arg1 = parts[1];
                const arg2 = parts.slice(2).join(' ');
                
                log(`> ${cmdInput.value}`, "var(--orange)");
                cmdInput.value = '';

                if (cmd === 'clear') { devConsole.innerHTML = ''; }
                else if (cmd === 'help') { log("clear, help, unlock <tier|all>, rickroll, github err <msg>"); }
                else if (cmd === 'unlock') {
                    const tiers = ['standart', 'pro', 'super', 'mega'];
                    if (arg1 === 'all') { tiers.forEach(t => unlockTier(t)); log("All unlocked!", "var(--green)"); }
                    else if (tiers.includes(arg1)) { unlockTier(arg1); log(`${arg1} unlocked!`, "var(--green)"); }
                }
                else if (cmd === 'rickroll') { window.open('https://www.youtube.com', '_blank'); }
                else if (cmd === 'github' && arg1 === 'err') { window.open(`https://github.com{encodeURIComponent(arg2)}`, '_blank'); }
            }
        });

        function unlockTier(t) {
            if (!unlocked.includes(t)) {
                unlocked.push(t);
                document.querySelectorAll(`[data-tier="${t}"]`).forEach(b => b.classList.add('unlocked'));
                if (t === 'mega') document.getElementById('btn-equal').classList.add('unlocked');
                statusLabel.innerText = "Тариф: " + t.toUpperCase();
                const btn = document.getElementById('buy-' + t);
                if (btn) {
                    btn.innerText = t.toUpperCase() + " - КУПЛЕНО"; btn.disabled = true;
                    const next = ['standart', 'pro', 'super', 'mega'][['standart', 'pro', 'super', 'mega'].indexOf(t) + 1];
                    if (next) document.getElementById('buy-' + next).disabled = false;
                }
            }
        }

        function press(act) {
            const btn = document.getElementById('btn-' + act);
            if (!unlocked.includes(btn.getAttribute('data-tier'))) {
                document.getElementById('calcMain').classList.add('shake');
                setTimeout(() => document.getElementById('calcMain').classList.remove('shake'), 300);
                return;
            }
            if (act === 'C') display.value = "";
            else if (act === 'del') display.value = display.value.slice(0, -1);
            else if (act === 'equal') { try { display.value = eval(display.value.replace(/÷/g,'/').replace(/×/g,'*')) || "0"; } catch { display.value = "Error"; } }
            else { const m = {add:'+', sub:'-', mul:'*', div:'/', dot:'.', perc:'%'}; display.value += m[act] || act; }
        }

        function startPurchase(tier, next) {
            if (!isAuth) { openModal('loginModal'); return; }
            purchaseActive = true;
            openModal('procModal');
            const status = document.getElementById('procStatus');
            const cancelBtn = document.getElementById('cancelBtn');
            const finalBtns = document.getElementById('finalBtns');
            const steps = ["соединение", "отправка запроса на покупку", "получение разрешения"];
            let idx = 0;

            cancelBtn.style.display = "block";
            finalBtns.style.display = "none";

            function run() {
                if (!purchaseActive) return;
                if (Math.random() < 0.05) { fail(); return; }
                status.innerHTML = `<span class="dots">${steps[idx]}</span>`;
                if (idx < steps.length - 1) { idx++; timer = setTimeout(run, 1200); }
                else { timer = setTimeout(progress, 1000); }
            }

            function progress() {
                let p = 0;
                function upd() {
                    if (!purchaseActive) return;
                    if (p < 99) { p += Math.floor(Math.random()*15)+1; if(p>99) p=99; status.innerText = `выдача... ${p}%`; timer = setTimeout(upd, 600); }
                    else { timer = setTimeout(() => { if(!purchaseActive) return; status.innerText="выдача... 100%"; setTimeout(()=>finish(), 800); }, 5000); }
                }
                upd();
            }

            function finish() {
                unlockTier(tier);
                cancelBtn.style.display="none";
                finalBtns.style.display="flex";
                status.innerText = "Готово!";
            }
            run();
        }

        function fail() { purchaseActive = false; document.getElementById('procStatus').innerHTML = "<span style='color:var(--red)'>ОШИБКА попробуйте заново</span>"; document.getElementById('cancelBtn').style.display="none"; document.getElementById('finalBtns').style.display="flex"; }

        function cancelPurchase() {
            purchaseActive = false; clearTimeout(timer);
            const status = document.getElementById('procStatus');
            status.innerHTML = "";
            const lines = ["остановка процесса покупки,", "завершение,", "покупка отменена"];
            lines.forEach((l, i) => setTimeout(() => { if(!purchaseActive) status.innerHTML += `<div style="color:var(--red)">${l}</div>`; }, i * 400));
            document.getElementById('cancelBtn').style.display = "none";
            document.getElementById('finalBtns').style.display = "flex";
        }

        function handleRegister() {
            const n = document.getElementById('rName').value, e1 = document.getElementById('rE1').value, e2 = document.getElementById('rE2').value, p1 = document.getElementById('rP1').value, p2 = document.getElementById('rP2').value;
            if (n && e1 === e2 && p1 === p2) { localStorage.setItem('user', JSON.stringify({n, e:e1, p:p1})); openModal('loginModal'); }
        }

        function handleLogin() {
            const n = document.getElementById('lName').value, p = document.getElementById('lPass').value, s = JSON.parse(localStorage.getItem('user'));
            if (s && s.n === n && s.p === p) {
                isAuth = true;
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('profileBox').style.display = 'block';
                document.getElementById('devBtn').style.display = 'inline-block';
                document.getElementById('pName').innerText = s.n;
                document.getElementById('pEmail').innerText = s.e;
                closeModals();
            }
        }

        function openModal(id) { if(id!=='procModal'&&id!=='devModal')document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.getElementById(id).style.display='flex'; }
        function closeModals() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
    </script>
</body>
</html>
